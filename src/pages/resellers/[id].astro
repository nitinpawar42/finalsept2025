---
import { db } from '../../firebase/admin.js';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const resellersSnapshot = await db.collection('resellers').get();
  const resellers = resellersSnapshot.docs.map(doc => ({ params: { id: doc.id } }));
  return resellers;
}

const { id } = Astro.params;
const resellerRef = db.collection('resellers').doc(id);
const resellerDoc = await resellerRef.get();
const reseller = resellerDoc.data();

const productsRef = resellerRef.collection('products');
const productsSnapshot = await productsRef.get();
const productIds = productsSnapshot.docs.map(doc => doc.id);

let products = [];
if (productIds.length > 0) {
  const productsCollectionRef = db.collection('products');
  const productsQuery = await productsCollectionRef.where('__name__', 'in', productIds).get();
  products = productsQuery.docs.map(doc => ({ id: doc.id, ...doc.data() }));
}
---

<Layout title={reseller.name}>
  <div class="max-w-4xl mx-auto py-12">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
      <img src={reseller.bannerImage || 'https://via.placeholder.com/1200x400'} alt={`${reseller.name} banner`} class="w-full h-64 object-cover">
      <div class="p-6">
        <h1 class="text-4xl font-bold text-gray-800 dark:text-gray-200 mb-2">{reseller.name}</h1>
        <p class="text-gray-600 dark:text-gray-400 mb-6">{reseller.bio}</p>
        
        <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4">Products</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {products.map(product => (
            <div class="bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md overflow-hidden">
              <img src={product.imageUrl || 'https://via.placeholder.com/300'} alt={product.name} class="w-full h-48 object-cover">
              <div class="p-4">
                <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200">{product.name}</h3>
                <p class="text-gray-600 dark:text-gray-400">${product.price.toFixed(2)}</p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</Layout>
